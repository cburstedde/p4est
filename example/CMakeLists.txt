
if(P4EST_HAVE_ARPA_INET_H OR P4EST_HAVE_NETINET_IN_H OR P4EST_HAVE_WINSOCK2_H)

foreach(t mesh particles points simple)
  add_executable(${t}2 ${t}/${t}2.c)
  target_link_libraries(${t}2 PRIVATE P4EST::P4EST SC::SC)
  if(MPI_FOUND)
    target_link_libraries(${t}2 PRIVATE MPI::MPI_C)
    add_test(NAME p4est:example:${t}2 COMMAND ${MPIEXEC_EXECUTABLE} ${MPIEXEC_NUMPROC_FLAG} ${Ncpu} $<TARGET_FILE:${t}2>)
  else()
    add_test(NAME p4est:example:${t}2 COMMAND $<TARGET_FILE:${t}2>)
  endif()
  set_tests_properties(p4est:example:${t}2 PROPERTIES TIMEOUT 10)
endforeach()

foreach(t bricks loadconn timings)
  add_executable(${t}2 timings/${t}2.c)
  target_link_libraries(${t}2 PRIVATE P4EST::P4EST SC::SC)
  if(MPI_FOUND)
    target_link_libraries(${t}2 PRIVATE MPI::MPI_C)
    add_test(NAME p4est:example:${t}2 COMMAND ${MPIEXEC_EXECUTABLE} ${MPIEXEC_NUMPROC_FLAG} ${Ncpu} $<TARGET_FILE:${t}2>)
  else()
    add_test(NAME p4est:example:${t}2 COMMAND $<TARGET_FILE:${t}2>)
  endif()
  set_tests_properties(p4est:example:${t}2 PROPERTIES TIMEOUT 10)
endforeach()

foreach(i 1 2 3 4)
  set(n p4est_step${i})
  add_executable(${n} steps/${n}.c)
  target_link_libraries(${n} PRIVATE P4EST::P4EST SC::SC)
  if(MPI_FOUND)
    target_link_libraries(${n} PRIVATE MPI::MPI_C)
    add_test(NAME p4est:example:${n} COMMAND ${MPIEXEC_EXECUTABLE} ${MPIEXEC_NUMPROC_FLAG} ${Ncpu} $<TARGET_FILE:${n}>)
  else()
    add_test(NAME p4est:example:${n} COMMAND $<TARGET_FILE:${n}>)
  endif()
  set_tests_properties(p4est:example:${n} PROPERTIES TIMEOUT 10)
endforeach()

set(n spheres)
add_executable(${n}2 ${n}/${n}2.c ${n}/p4est_${n}.c)
target_link_libraries(${n}2 PRIVATE P4EST::P4EST SC::SC)
if(MPI_FOUND)
  target_link_libraries(${n}2 PRIVATE MPI::MPI_C)
  add_test(NAME p4est:example:${n}2 COMMAND ${MPIEXEC_EXECUTABLE} ${MPIEXEC_NUMPROC_FLAG} ${Ncpu} $<TARGET_FILE:${n}2>)
else()
  add_test(NAME p4est:example:${n}2 COMMAND $<TARGET_FILE:${n}2>)
endif()
set_tests_properties(p4est:example:${n}2 PROPERTIES TIMEOUT 10)

endif()
